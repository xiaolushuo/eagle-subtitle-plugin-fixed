<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagle å­—å¹•æ˜¾ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: transparent;
            overflow: hidden;
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            user-select: none;
        }
        
        /* å­—å¹•å®¹å™¨ */
        #subtitleContainer {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 1200px;
            text-align: center;
            pointer-events: none;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        #subtitleContainer.top {
            top: 10%;
            bottom: auto;
        }
        
        #subtitleContainer.middle {
            top: 50%;
            bottom: auto;
            transform: translate(-50%, -50%);
        }
        
        /* å­—å¹•æ–‡æœ¬ */
        #subtitleText {
            display: inline-block;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 18px;
            line-height: 1.6;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9);
            max-width: 100%;
            word-wrap: break-word;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-weight: 500;
            letter-spacing: 0.5px;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #subtitleText.visible {
            opacity: 1;
        }
        
        #subtitleText:empty {
            display: none;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        #controlPanel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 12px;
            font-size: 12px;
            opacity: 0.2;
            transition: opacity 0.3s ease;
            pointer-events: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 180px;
        }
        
        #controlPanel:hover {
            opacity: 1;
        }
        
        .panel-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            text-align: center;
            color: #fff;
        }
        
        .control-button {
            display: block;
            width: 100%;
            margin: 8px 0;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .control-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .control-button:active {
            transform: translateY(0);
        }
        
        /* é€šçŸ¥æ¶ˆæ¯ */
        #notification {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 2000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #notification.show {
            opacity: 1;
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        #statusIndicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            opacity: 0.6;
            transition: all 0.3s ease;
        }
        
        #statusIndicator.active {
            background: #44ff44;
            opacity: 1;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            #subtitleContainer {
                width: 90%;
                bottom: 5%;
            }
            
            #subtitleText {
                font-size: 16px;
                padding: 8px 16px;
            }
            
            #controlPanel {
                top: 10px;
                right: 10px;
                padding: 10px;
                min-width: 140px;
            }
        }
    </style>
</head>
<body>
    <!-- å­—å¹•å®¹å™¨ -->
    <div id="subtitleContainer">
        <div id="subtitleText"></div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div id="controlPanel">
        <div class="panel-title">ğŸ¬ å­—å¹•æ§åˆ¶</div>
        <button class="control-button" id="toggleSubtitles">ğŸ‘ï¸ æ˜¾ç¤º/éšè—</button>
        <button class="control-button" id="adjustOffset">â° è°ƒæ•´åç§»</button>
        <button class="control-button" id="changeStyle">ğŸ¨ æ ·å¼è®¾ç½®</button>
        <button class="control-button" id="reloadSubtitles">ğŸ”„ é‡æ–°åŠ è½½</button>
    </div>
    
    <!-- é€šçŸ¥æ¶ˆæ¯ -->
    <div id="notification"></div>
    
    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="statusIndicator"></div>
    
    <script>
        const { ipcRenderer } = require('electron');
        
        // DOM å…ƒç´ 
        const subtitleText = document.getElementById('subtitleText');
        const subtitleContainer = document.getElementById('subtitleContainer');
        const controlPanel = document.getElementById('controlPanel');
        const notification = document.getElementById('notification');
        const statusIndicator = document.getElementById('statusIndicator');
        
        // çŠ¶æ€å˜é‡
        let subtitlesVisible = true;
        let currentStyle = {
            fontSize: 18,
            position: 'bottom'
        };
        
        // ç›‘å¬å­—å¹•æ›´æ–°
        ipcRenderer.on('subtitle-update', (event, data) => {
            if (data.text && subtitlesVisible) {
                subtitleText.textContent = data.text;
                subtitleText.classList.add('visible');
                statusIndicator.classList.add('active');
            } else {
                subtitleText.classList.remove('visible');
                statusIndicator.classList.remove('active');
            }
        });
        
        // ç›‘å¬æ ·å¼æ›´æ–°
        ipcRenderer.on('style-update', (event, style) => {
            updateSubtitleStyle(style);
        });
        
        // ç›‘å¬é€šçŸ¥
        ipcRenderer.on('notification', (event, message) => {
            showNotification(message);
        });
        
        // æ§åˆ¶é¢æ¿äº‹ä»¶
        document.getElementById('toggleSubtitles').addEventListener('click', () => {
            subtitlesVisible = !subtitlesVisible;
            if (!subtitlesVisible) {
                subtitleText.classList.remove('visible');
                statusIndicator.classList.remove('active');
            }
            ipcRenderer.send('toggle-subtitles-request');
        });
        
        document.getElementById('adjustOffset').addEventListener('click', () => {
            ipcRenderer.send('adjust-offset-request');
        });
        
        document.getElementById('changeStyle').addEventListener('click', () => {
            ipcRenderer.send('style-change-request');
        });
        
        document.getElementById('reloadSubtitles').addEventListener('click', () => {
            ipcRenderer.send('reload-subtitles-request');
        });
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'h':
                    // H é”®æ˜¾ç¤º/éšè—å­—å¹•
                    subtitlesVisible = !subtitlesVisible;
                    if (!subtitlesVisible) {
                        subtitleText.classList.remove('visible');
                        statusIndicator.classList.remove('active');
                    }
                    break;
                case 'o':
                    // O é”®è°ƒæ•´åç§»
                    ipcRenderer.send('adjust-offset-request');
                    break;
                case 's':
                    // S é”®æ›´æ”¹æ ·å¼
                    ipcRenderer.send('style-change-request');
                    break;
                case 'escape':
                    // ESC é”®éšè—æ§åˆ¶é¢æ¿
                    controlPanel.style.opacity = '0';
                    setTimeout(() => {
                        controlPanel.style.opacity = '';
                    }, 3000);
                    break;
            }
        });
        
        // é¼ æ ‡äº‹ä»¶
        document.addEventListener('mousemove', (e) => {
            // é¼ æ ‡ç§»åŠ¨æ—¶æ˜¾ç¤ºæ§åˆ¶é¢æ¿
            if (e.clientY < 100) {
                controlPanel.style.opacity = '1';
            }
        });
        
        // æ›´æ–°å­—å¹•æ ·å¼
        function updateSubtitleStyle(style) {
            if (style.fontSize) {
                subtitleText.style.fontSize = style.fontSize + 'px';
                currentStyle.fontSize = style.fontSize;
            }
            
            if (style.position) {
                subtitleContainer.className = '';
                if (style.position !== 'bottom') {
                    subtitleContainer.classList.add(style.position);
                }
                currentStyle.position = style.position;
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            adjustSubtitlePosition();
        });
        
        // è°ƒæ•´å­—å¹•ä½ç½®
        function adjustSubtitlePosition() {
            const container = document.getElementById('subtitleContainer');
            const windowHeight = window.innerHeight;
            const containerHeight = container.offsetHeight;
            
            // ç¡®ä¿å­—å¹•ä¸ä¼šè¶…å‡ºçª—å£
            if (containerHeight > windowHeight * 0.3) {
                container.style.width = '90%';
                subtitleText.style.fontSize = Math.max(12, currentStyle.fontSize - 2) + 'px';
            }
        }
        
        // åˆå§‹åŒ–
        console.log('ğŸŒ Eagle å­—å¹•æ˜¾ç¤ºå±‚å·²åŠ è½½');
        
        // è‡ªåŠ¨éšè—æ§åˆ¶é¢æ¿
        setTimeout(() => {
            controlPanel.style.opacity = '0.2';
        }, 5000);
    </script>
</body>
</html>